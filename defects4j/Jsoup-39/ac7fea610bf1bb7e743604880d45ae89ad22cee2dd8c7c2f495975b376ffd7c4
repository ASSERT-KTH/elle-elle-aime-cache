{
    "generation": "/**\n * Parses the provided byte data into a Document, using the specified charset and base URI.\n * If charset is null, attempts to detect from HTML meta tags, defaulting to UTF-8.\n * \n * @param byteData    byte buffer containing HTML data\n * @param charsetName character set of the byte data (or null to auto-detect)\n * @param baseUri     base URI for resolving relative links\n * @param parser      parser to use for HTML parsing\n * @return parsed Document\n */\nstatic Document parseByteData(ByteBuffer byteData, String charsetName, String baseUri, Parser parser) {\n    String docData;\n    Document doc = null;\n    boolean bomDetected = false;\n\n    if (charsetName == null) { // determine from meta, safe parse as UTF-8\n        // Initial decode as UTF-8 to check for BOM and meta tags\n        docData = Charset.forName(\"UTF-8\").decode(byteData).toString();\n        \n        // Check for UTF-8 BOM indicator\n        if (docData.length() > 0 && docData.charAt(0) == 65279) {\n            bomDetected = true;\n            docData = docData.substring(1);\n        }\n        \n        doc = parser.parseInput(docData, baseUri);\n        Element meta = doc.select(\"meta[http-equiv=content-type], meta[charset]\").first();\n        \n        if (meta!= null) { // if not found, will keep utf-8 as best attempt\n            String foundCharset;\n            if (meta.hasAttr(\"http-equiv\")) {\n                foundCharset = getCharsetFromContentType(meta.attr(\"content\"));\n                if (foundCharset == null && meta.hasAttr(\"charset\")) {\n                    try {\n                        if (Charset.isSupported(meta.attr(\"charset\"))) {\n                            foundCharset = meta.attr(\"charset\");\n                        }\n                    } catch (IllegalCharsetNameException e) {\n                        foundCharset = null;\n                    }\n                }\n            } else {\n                foundCharset = meta.attr(\"charset\");\n            }\n\n            if (foundCharset!= null && foundCharset.length()!= 0 &&!foundCharset.equalsIgnoreCase(\"UTF-8\")) { // need to re-decode\n                foundCharset = foundCharset.trim().replaceAll(\"[\\\"']\", \"\");\n                charsetName = foundCharset;\n                byteData.rewind();\n                docData = Charset.forName(foundCharset).decode(byteData).toString();\n                if (bomDetected) {\n                    // If BOM was already detected and removed, no need to check again\n                    doc = parser.parseInput(docData, baseUri);\n                } else {\n                    // Re-check for BOM in the re-decoded data\n                    if (docData.length() > 0 && docData.charAt(0) == 65279) {\n                        docData = docData.substring(1);\n                    }\n                    doc = parser.parseInput(docData, baseUri);\n                }\n            } else if (bomDetected) {\n                // If we initially detected a BOM and the charset is indeed UTF-8 (or remains undetected),\n                // ensure the document reflects UTF-8 and has the BOM handled\n                doc.outputSettings().charset(\"UTF-8\");\n            }\n        } else if (bomDetected) {\n            // No meta charset found, but BOM was detected; ensure UTF-8 is set\n            doc.outputSettings().charset(\"UTF-8\");\n        }\n    } else { // specified by content type header (or by user on file load)\n        Validate.notEmpty(charsetName, \"Must set charset arg to character set of file to parse. Set to null to attempt to detect from HTML\");\n        docData = Charset.forName(charsetName).decode(byteData).toString();\n        // Check for UTF-8 BOM indicator, but only if the specified charset is UTF-8\n        if (charsetName.equalsIgnoreCase(\"UTF-8\") && docData.length() > 0 && docData.charAt(0) == 65279) {\n            docData = docData.substring(1);\n        }\n        doc = parser.parseInput(docData, baseUri);\n    }\n    \n    if (doc == null) {\n        doc = parser.parseInput(docData, baseUri);\n        doc.outputSettings().charset(charsetName!= null? charsetName : \"UTF-8\");\n    }\n    return doc;\n}",
    "exact_match": false,
    "ast_match": false,
    "compile": true,
    "test": false
}