{
    "generation": "private Object decode(Channel channel, SocketAddress remoteAddress, ByteBuf buf) {\n\n    if (buf.readableBytes() < 2) {\n        return null;\n    }\n\n    int length = buf.getUnsignedShort(buf.readerIndex());\n    if (buf.readableBytes() < length) {\n        return null;\n    }\n\n    int type = buf.getUnsignedShort(buf.readerIndex() + 2);\n    boolean isResponse = (type & 0x8000) != 0;\n    type &= 0x7fff;\n\n    buf.skipBytes(4);\n\n    Position position = new Position(getProtocolName());\n\n    if (type == MSG_LOGIN) {\n\n        String imei = ByteBufUtil.hexDump(buf.readSlice(8)).substring(1);\n        buf.readUnsignedByte(); // language\n        if (channel != null) {\n            getDeviceSession(channel, remoteAddress, imei);\n        }\n\n    } else if (type == MSG_GPS) {\n\n        position.setValid(true);\n        position.setTime(new Date(buf.readUnsignedInt() * 1000L));\n        position.setLongitude(buf.readInt() / 1800000.0);\n        position.setLatitude(buf.readInt() / 1800000.0);\n        position.set Speed(buf.readUnsignedShort());\n        position.setCourse(buf.readUnsignedShort());\n\n        int flags = buf.readUnsignedShort();\n        position.set(Position.KEY_IGNOFFON, BitUtil.check(flags, 13));\n        position.set(Position.KEY_IGNITION, BitUtil.check(flags, 12));\n        position.set(Position.KEY_INPUT, BitUtil.between(flags, 2, 7));\n        position.set(Position.KEY_OUTPUT, BitUtil.between(flags, 8, 11));\n        position.set(Position.KEY_ALARM, BitUtil.check(flags, 0));\n\n        int satellites = buf.readUnsignedByte();\n        position.set(Position.KEY_SATELLITES, satellites);\n        position.setAccuracy BitUtil.between(flags, 0, 1) == 1 ? 50 : satellites <= 3 ? 300 : 150);\n        position.setAltitude(buf.readShort());\n\n        return position;\n\n    } else if (type == MSG_LBS) {\n\n        position.setValid BitUtil.check(buf.readUnsignedByte(), 4));\n\n        if (channel != null) {\n            DeviceSession deviceSession = getDeviceSession(channel, remoteAddress);\n            if (deviceSession != null) {\n                position.setTime(new Date(deviceSession.lastIndexOf(Position.KEY_TIME)));\n            }\n        }\n\n        position.setLatitude((buf.readUnsignedInt() - 1800000) / 24000.0);\n        position.setLongitude((buf.readUnsignedInt() - 7200000) / 24000.0);\n        position.setAccuracy(Math.max(101, buf.readUnsignedShort()));\n\n        return position;\n\n    } else if (type == MSG_STATUS) {\n\n        position.set(Position.KEY_IGNOFFON, BitUtil.check(buf.readUnsignedInt(), 2));\n        position.set(Position.KEY_IGNITION, BitUtil.check(buf.readUnsignedInt(), 1));\n\n    } else if (type == MSG_ALARM) {\n\n        position.set(Position.KEY_ALARM, buf.readUnsignedByte());\n        position.set(Position.KEY_STATUS, buf.readUnsignedByte());\n\n    } else if (type == MSG_OBD) {\n\n        position.set(\"obd\", buf.toString(buf.readerIndex(), buf.readableBytes(), StandardCharsets.US_ASCII));\n        buf.skipBytes(buf.readableBytes());\n\n    } else if (type == MSG_STRING) {\n\n        position.set(\"message\", buf.toString(buf.readerIndex(), buf.readableBytes(), StandardCharsets.US_ASCII));\n        buf.skipBytes(buf.readableBytes());\n\n    }\n\n    if (isResponse) {\n        return null;\n    }\n\n    return position;\n}",
    "exact_match": false,
    "ast_match": false,
    "compile": null,
    "test": false
}